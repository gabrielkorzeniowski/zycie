<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<title>Notatnik</title>
  <link rel="icon" type="image/png" href="notatnik.png">
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  * { box-sizing: border-box; }
  body {
    font-family: Arial, sans-serif;
    margin: 10px;
    background: #e6e6e6;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 10px;
    color: #0a2540;
  }

  h2 { margin-bottom: 15px; color: #333; }

.header-bar {
  width: 100%;
  max-width: 1100px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 15px;
}

.timer-frame {
  border: none;
  width: 220px;   /* dopasuj do timera */
  height: 60px;   /* dopasuj do timera */
}

  .container {
    display: flex;
    gap: 15px;
    width: 100%;
    max-width: 1100px;
    flex-wrap: nowrap;
    background: #f9f9f9;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 20px;
  }

  .fields, .summary-section {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    padding: 15px;
  }

  .fields { flex: 1.3; display:flex; flex-direction:column; gap:12px; max-height:80vh; overflow:hidden; }
  .summary-section { flex:1; display:flex; flex-direction:column; max-height:80vh; }

  .field-row { display:flex; align-items:center; gap:8px; }
  label { width:160px; font-weight:bold; user-select:none; }

  input, textarea {
    flex:1;
    padding:6px 8px;
    font-size:1em;
    border:1px solid #ccc;
    border-radius:4px;
    font-family:inherit;
  }
  textarea { resize:none; line-height:1.2em; }
  #notatki { height:100px; }
  .copy-btn {
    padding:6px 10px;
    cursor:pointer;
    font-size:0.9em;
    border:none;
    background:#c9c9c9;
    color:white;
    border-radius:4px;
    user-select:none;
    transition:background-color .15s;
    white-space:nowrap;
  }
  .copy-btn:hover { background:#0056b3; }

  .actions { margin-top:12px; display:flex; justify-content:space-between; gap:10px; }
  .actions button { flex:1; padding:10px 0; font-size:1em; cursor:pointer; border:none; border-radius:5px; background:#28a745; color:white; }
  .actions button.clear-btn { background:#dc3545; }
  .actions button:hover { opacity:.95; }

  .summary-label-copy { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
  #summary { flex:1; padding:10px; font-family:monospace; font-size:0.9em; border:1px solid #ccc; border-radius:4px; background:#fafafa; white-space:pre-wrap; overflow:auto; }

  /* VIP visual */
  .vip-input { border-color: red !important; box-shadow: 0 0 0 2px rgba(255,0,0,0.06); }
  #vip-note { width:100%; text-align:center; color:red; font-weight:bold; font-size:12px; margin-top:4px; display:none; }

  .clickable { cursor:pointer; text-decoration:underline; color:#2d5c8a; }
  .clickable:hover { text-decoration:none; }

.standard-info {
  margin-top: 20px;
  width: 100%;
  max-width: 1100px;
  background: #fff;
  border-radius: 8px;
  padding: 15px;
  display: flex;
  gap: 15px;
  align-items: center;
  justify-content: center; 
  text-align: center;
}

  .cup-link img { width:20px; height:20px; display:block; transition: box-shadow .12s, transform .12s; }
  .cup-link:hover img { box-shadow:0 0 0 2px #0a2540; transform:translateY(-1px); }
</style>
</head>
<body>

<div class="header-bar">
<h2 style="padding-left: 140px;">Notatnik</h2>
  <iframe src="timer.html" class="timer-frame" title="Timer"></iframe>
</div>

<div class="container">

  <div class="fields">
    <div class="field-row" style="flex-direction:column; align-items:flex-start;">
      <div style="display:flex; align-items:center; width:100%; gap:8px;">
        <label for="polisa" style="width:160px;">
          <span class="clickable" id="copySeriesSpan" title="Kopiuj serię">Seria<span style="font-weight:normal"></span></span>
          i
          <span class="clickable" id="copyNumberSpan" title="Kopiuj numer">numer<span style="font-weight:normal"></span></span>
          polisy:
        </label>

        <input id="polisa" type="text" placeholder="Wpisz serię i numer polisy" style="flex:1;">
        <button class="copy-btn" id="copyPolisaBtn">Kopiuj</button>
      </div>

      <div id="vip-note">TO POLISA VIP!</div>
    </div>

    <div class="field-row">
      <label for="imie">Imię:</label>
      <input id="imie" type="text" placeholder="Wpisz imię">
      <button class="copy-btn" data-copy-for="imie">Kopiuj</button>
    </div>

    <div class="field-row">
      <label for="nazwisko">Nazwisko:</label>
      <input id="nazwisko" type="text" placeholder="Wpisz nazwisko">
      <button class="copy-btn" data-copy-for="nazwisko">Kopiuj</button>
    </div>

    <div class="field-row">
      <label for="pesel">PESEL:</label>
      <input id="pesel" type="text" placeholder="Wpisz PESEL">
      <button class="copy-btn" data-copy-for="pesel">Kopiuj</button>
    </div>

    <div class="field-row">
      <label for="zgloszenie">Numer zgłoszenia:</label>
      <input id="zgloszenie" type="text" placeholder="Wpisz zgłoszenie">
      <button class="copy-btn" data-copy-for="zgloszenie">Kopiuj</button>
    </div>

    <div class="field-row" style="align-items:flex-start;">
      <label for="notatki">Pozostałe notatki:</label>
      <textarea id="notatki"></textarea>
      <button class="copy-btn" data-copy-for="notatki" style="height:100px;">Kopiuj</button>
    </div>

    <div class="actions">
      <button class="clear-btn" id="clearBtn">Wyczyść notatkę</button>
      <button id="appendBtn">Dopisanie do zbiorczej notatki</button>
    </div>
  </div>

  <div class="summary-section">
    <div class="summary-label-copy">
      <label for="summary">Zbiorcza notatka:</label>
      <button class="copy-btn" data-copy-for="summary">Kopiuj całość</button>
    </div>
    <textarea id="summary" readonly></textarea>
  </div>

</div>

<div class="standard-info">
  Wesprzyj rozwój aplikacji i kliknij w ikonę filiżanki, aby postawić mi kawę
  <a class="cup-link" href="kawa.html" target="_blank" rel="noopener noreferrer" title="Postaw kawę">
    <img src="kubek.png" alt="kubek" />
  </a>
</div>

<script>
/* ====================
   Lista VIP - NIE MODYFIKOWAĆ
   ==================== */
const vipPoliciesBase = [
  "NG0014864","NG0037047","NG0028058","NG0043790","NG0043803",
  "NG0043806","NG0043805","NG0028045","NG0038635","NG0032785",
  "NK0010296","NG0024196","EP0008394","EP0008397","EP0008398",
  "EP0008399","EP0008400","EP0008401","EP0008403","EP0008404",
  "EP0008405","NG0024214","NG0029808","NG0029815","NG0029816",
  "NG0030385","NG0030432","NG0030438","NG0030439","NG0030440",
  "NG0030441","NG0030443","NG0030590","NG0030592"
];

/* ====================
   Normalizacja (nie modyfikuje input podczas wpisywania)
   Zasady:
   - usuń wszystko co nie-alfanumeryczne
   - uppercase
   - docelowo 9 znaków: 2 (seria) + 7 cyfr (numer)
   - jeśli ciąg to same cyfry: pierwsze 2 cyfry -> seria, reszta -> numer
   - numer dopełnij z lewej do 7 cyfr zerami
   - jeśli brak znaków dla serii, wypełnij '0'
   ==================== */
function normalizePolisaFromRaw(raw) {
  if (!raw) return "00" + "0000000"; // safety
  const cleaned = (raw + "").replace(/[^a-zA-Z0-9]/g, "").toUpperCase();

  // ensure at least 2 chars for series by padding with '0' on right if needed
  const seriesChar1 = cleaned.charAt(0) || "0";
  const seriesChar2 = cleaned.charAt(1) || "0";
  const series = (seriesChar1 + seriesChar2).toUpperCase();

  // remaining characters after first two in cleaned:
  const remainder = cleaned.slice(2);
  // collect only digits from remainder (per rules number must be digits)
  const digitsOnly = remainder.replace(/[^0-9]/g, "");

  // Special rule: if user input is composed only of digits (cleaned all digits),
  // then series are first two digits and number is rest of digits.
  const cleanedIsAllDigits = /^[0-9]+$/.test(cleaned);
  let numberPart = digitsOnly;
  if (cleanedIsAllDigits) {
    // series are first two digits, number is the rest of digits (could be empty)
    const s1 = cleaned.charAt(0) || "0";
    const s2 = cleaned.charAt(1) || "0";
    const s = (s1 + s2);
    // number is everything after first two digits:
    numberPart = cleaned.slice(2);
    // But since we already set series above as first two chars, that's consistent.
  }

  // pad number to 7 digits (on the left), if empty -> '0000000'
  const normalizedNumber = (numberPart ? String(parseInt(numberPart, 10)).padStart(7, "0") : "0000000");

  // final normalized polisa: series (2 chars) + 7-digit number
  return (series + normalizedNumber).toUpperCase();
}

/* ====================
   Split normalized -> {series, number}
   (expects 9-character normalized string; but is safe)
   ==================== */
function splitNormalizedPolisa(norm) {
  const s = (norm || "").toString().toUpperCase();
  const series = s.slice(0,2) || "";
  const number = s.slice(-7) || "";
  return { series, number };
}

/* ====================
   VIP check on-the-fly (without changing field value)
   - If normalized(currentInput) ∈ vipPoliciesBase => show vip visuals
   - This runs on input event
   ==================== */
const polisaInput = document.getElementById("polisa");
const vipNote = document.getElementById("vip-note");

function checkVipAndVisuals() {
  const raw = polisaInput.value;
  const normalized = normalizePolisaFromRaw(raw);
  const isVip = vipPoliciesBase.includes(normalized);
  if (isVip) {
    polisaInput.classList.add("vip-input");
    vipNote.style.display = "block";
  } else {
    polisaInput.classList.remove("vip-input");
    vipNote.style.display = "none";
  }
}

/* attach live check */
polisaInput.addEventListener("input", checkVipAndVisuals);
checkVipAndVisuals();

/* ====================
   Kopiowanie (TYLKO RAZ) - Polisa / Seria / Numer
   - przy kliknięciu: najpierw sformatuj (normalizePolisaFromRaw),
     przypisz sformatowaną wartość do pola (podmiana), 
     potem skopiuj dokładnie to, co trzeba.
   - NIGDY nie dopisujemy niczego do pola w akcie kopiowania poza tą jednorazową
   - Kopiowanie innych pól: kopiuj dokładnie ich wartość (bez formatowania)
   ==================== */

function copyTextToClipboard(text) {
  // pojedyncze kopiowanie
  navigator.clipboard.writeText(text).catch(()=> {
    // fallback: selekcja i execCommand (stare przeglądarki)
    const ta = document.createElement("textarea");
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand("copy"); } catch(e){}
    document.body.removeChild(ta);
  });
}

/* Kopiuj całą polisę (button) */
document.getElementById("copyPolisaBtn").addEventListener("click", function () {
  const raw = polisaInput.value;
  const normalized = normalizePolisaFromRaw(raw);
  polisaInput.value = normalized;            // podmieniamy pole NA RAZ
  checkVipAndVisuals();                      // aktualizacja VIP visuals
  copyTextToClipboard(normalized);           // kopiujemy raz
});

/* Kopiuj serię (klik na span) */
document.getElementById("copySeriesSpan").addEventListener("click", function () {
  const raw = polisaInput.value;
  const normalized = normalizePolisaFromRaw(raw);
  polisaInput.value = normalized;            // podmieniamy pole NA RAZ
  checkVipAndVisuals();
  const { series } = splitNormalizedPolisa(normalized);
  if (series) copyTextToClipboard(series);
});

/* Kopiuj numer (klik na span) */
document.getElementById("copyNumberSpan").addEventListener("click", function () {
  const raw = polisaInput.value;
  const normalized = normalizePolisaFromRaw(raw);
  polisaInput.value = normalized;            // podmieniamy pole NA RAZ
  checkVipAndVisuals();
  const { number } = splitNormalizedPolisa(normalized);
  if (number) copyTextToClipboard(number);
});

/* Kopiowanie innych pól (przyciski "Kopiuj" przy inputach) */
document.querySelectorAll('button.copy-btn[data-copy-for]').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const id = btn.getAttribute('data-copy-for');
    const el = document.getElementById(id);
    if (!el) return;
    copyTextToClipboard(el.value || el.innerText || "");
  });
});

/* Kopiowanie zbiorczej notatki */
document.querySelector('button.copy-btn[data-copy-for="summary"]')?.addEventListener('click', ()=>{
  copyTextToClipboard(document.getElementById('summary').value || "");
});

/* ====================
   Append to summary (only non-empty fields)
   Format:
   gg:mm, dd-mm-rrrr
   Polisa: AB1234567     (or "Polisa VIP: AB1234567")
   Imię i Nazwisko: Jan Kowalski
   PESEL: ...
   Numer zgłoszenia: ...
   Notatki: ...
   (only include non-empty lines)
   ==================== */
function pad2(n){ return n<10? '0'+n : String(n); }

document.getElementById("appendBtn").addEventListener("click", ()=>{
  const now = new Date();
  const time = pad2(now.getHours()) + ":" + pad2(now.getMinutes());
  const date = pad2(now.getDate()) + "-" + pad2(now.getMonth()+1) + "-" + now.getFullYear();
  const header = `${time}, ${date}\n`;

  const rawPol = polisaInput.value;
  const normalizedPol = normalizePolisaFromRaw(rawPol);
  const isVip = vipPoliciesBase.includes(normalizedPol);

  const lines = [header];

  if (rawPol && rawPol.trim() !== "") {
    lines.push( (isVip ? "Polisa VIP: " : "Polisa: ") + normalizedPol );
  }

  const imie = document.getElementById("imie").value.trim();
  const nazwisko = document.getElementById("nazwisko").value.trim();
  if (imie || nazwisko) {
    const full = [imie, nazwisko].filter(Boolean).join(" ");
    lines.push("Imię i Nazwisko: " + full);
  }

  const pesel = document.getElementById("pesel").value.trim();
  if (pesel) lines.push("PESEL: " + pesel);

  const zg = document.getElementById("zgloszenie").value.trim();
  if (zg) lines.push("Numer zgłoszenia: " + zg);

  const not = document.getElementById("notatki").value.trim();
  if (not) lines.push("Notatki: " + not);

  lines.push("--------------------------\n");

  // dopisz tylko jeśli jest co dopisać (przynajmniej jakieś pole)
  const nonEmptyCount = lines.filter(l => l && l.trim()).length;
  if (nonEmptyCount > 1) {
    const summary = document.getElementById("summary");
    summary.value = summary.value + lines.join("\n");
  }
});

/* ====================
   Clear button
   ==================== */
document.getElementById("clearBtn").addEventListener("click", ()=>{
  ["polisa","imie","nazwisko","pesel","zgloszenie","notatki"].forEach(id=>{
    const el = document.getElementById(id);
    if (el) el.value = "";
  });
  checkVipAndVisuals();
});

/* initial small adjustments */
document.querySelectorAll('.cup-link img').forEach(img=>{
  img.width = 10; img.height = 10;
});
</script>

</body>
</html>
